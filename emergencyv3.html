<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Emergency Health Trainer</title>
    <meta name="description" content="Emergency medical training tool with room selection and condition sounds">
    <meta name="theme-color" content="#0c1a2d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFhSURBVHgB7ZbRbcMwDEQprzvvM0NP0R0yQ2fwCj1D6Qny3KX6gJggAerH0geEH5IACR5FZgzDcA+r3/CG10o4e7wm4WwrhA0hK4F/CAjYQAIBLhFgEJgWgEEgFQJ4FICg7tH/OwE9+kMq+3/qS8D+h7YAYzNtJ0l0BNZ9BOs4ygXIfYc7AtERQAKhTmhDQF6jEAQ2QRXmCJRAoAXK/V6DgF8uGAhUQ6AaArURCIlAawRCIVATAXm9a0bAR4BtQnAE3CYERcBtQlAE3CYERaA0AiERKIWATwgTg8ALBMK1YlwI+JghMgJ8zBAZAT5miIwAHzMERcBHoBsC3RCoikAGBEohUBOBEgh0RyATAj4xRSYEfGKKTAj4xBSZEPCJKQIgcMqEQxPw4VANgRJ4O0igKb5tAq2F4gYBN4fqCKyDADd9CJgiGgKlTNgJwU2X7iKJ8XUF8xSrdBVJNN/wFAlI/gN1Aq4cN/kvmOnK/j+JLe7/wTAf1Y8AAAAASUVORK5CYII=">
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAFhSURBVHgB7ZbRbcMwDEQprzvvM0NP0R0yQ2fwCj1D6Qny3KX6gJggAerH0geEH5IACR5FZgzDcA+r3/CG10o4e7wm4WwrhA0hK4F/CAjYQAIBLhFgEJgWgEEgFQJ4FICg7tH/OwE9+kMq+3/qS8D+h7YAYzNtJ0l0BNZ9BOs4ygXIfYc7AtERQAKhTmhDQF6jEAQ2QRXmCJRAoAXK/V6DgF8uGAhUQ6AaArURCIlAawRCItAagZAItEagOgKZEPCJKTIh4BNTZELAJ6bIhIBPTBEcAR+Bbgh0Q6AqAhkQKIVATQRKINAdgUwI+MQUmRDwiSkyIeATU2RCwCemCI7APgQOTcCHQzUESuDtIIGm+LYJtBaKGwTcHKojsA4C3PQhYIpoCJQyYScEN126iyTG1xXMU6zSVSQx/gN1At8tntlMdfv/vgAAAABJRU5ErkJggg==">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset and Base */
        :root {
            --primary: #0c1a2d;
            --secondary: #1a3a5f;
            --accent: #4fc3f7;
            --accent-dark: #1565c0;
            --danger: #c62828;
            --success: #388e3c;
            --warning: #ffc107;
            --text: #fff;
            --text-light: #bbdefb;
            --card-bg: #1e3a5f;
            --card-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            --card-hover: #234a7a;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 80px;
        }
        
        /* Web App Header */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(12, 26, 45, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(79, 195, 247, 0.2);
        }
        
        .app-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent);
        }
        
        .app-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            background: none;
            border: none;
            color: var(--accent);
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .icon-btn:hover {
            background: rgba(79, 195, 247, 0.1);
        }
        
        .install-btn {
            background: linear-gradient(145deg, var(--accent), #29b6f6);
            color: var(--primary);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 8px;
        }
        
        .install-btn.show {
            display: flex;
        }
        
        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 70px auto 0;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--accent);
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1rem;
            color: var(--text-light);
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        /* App Stages */
        .app-stages {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 15px;
        }
        
        .stage {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .stage.active {
            background: var(--accent-dark);
            box-shadow: 0 4px 12px rgba(21, 101, 192, 0.4);
        }
        
        .stage-number {
            background: rgba(255, 255, 255, 0.2);
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }
        
        .stage.active .stage-number {
            background: #fff;
            color: var(--accent-dark);
        }
        
        /* Room Selection */
        .room-selection {
            text-align: center;
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .room-selection.hidden {
            display: none;
        }
        
        .room-selection h2 {
            color: var(--accent);
            margin-bottom: 25px;
            font-size: 1.5rem;
        }
        
        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .room-card {
            background: linear-gradient(145deg, var(--card-bg), #152642);
            border: none;
            border-radius: 12px;
            padding: 25px 15px;
            color: var(--text);
            font-size: 1.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 120px;
        }
        
        .room-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, var(--card-hover), #193355);
        }
        
        .room-card.selected {
            background: linear-gradient(145deg, var(--accent-dark), #0d47a1);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(21, 101, 192, 0.4);
        }
        
        .room-card.alarming {
            animation: alarmPulse 1s infinite alternate;
            background: linear-gradient(145deg, var(--danger), #b71c1c);
        }
        
        .room-label {
            font-size: 0.9rem;
            margin-top: 8px;
            color: var(--text-light);
            font-weight: 500;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            padding: 20px;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: linear-gradient(145deg, var(--card-bg), #152642);
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            transform: translateY(20px);
            transition: transform 0.4s ease;
        }
        
        .modal.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-icon {
            font-size: 3.5rem;
            color: var(--accent);
            margin-bottom: 20px;
        }
        
        .modal-title {
            color: var(--text);
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .modal-room {
            font-size: 3rem;
            font-weight: 800;
            color: var(--accent);
            margin: 20px 0;
            text-shadow: 0 2px 10px rgba(79, 195, 247, 0.4);
        }
        
        .modal-text {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .modal-btn {
            padding: 14px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex: 1;
        }
        
        .btn-primary {
            background: linear-gradient(145deg, var(--accent), #29b6f6);
            color: var(--primary);
        }
        
        .btn-primary:hover {
            background: linear-gradient(145deg, #29b6f6, var(--accent));
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(79, 195, 247, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        /* Condition Selection */
        .condition-selection {
            padding: 25px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            margin-bottom: 30px;
            display: none;
        }
        
        .condition-selection.active {
            display: block;
        }
        
        .condition-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .selected-room {
            background: rgba(79, 195, 247, 0.15);
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent);
            border: 2px solid rgba(79, 195, 247, 0.3);
        }
        
        .selected-room i {
            margin-right: 8px;
        }
        
        .change-room {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            color: var(--text);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .change-room:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .conditions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .condition-card {
            background: linear-gradient(145deg, var(--card-bg), #152642);
            border: none;
            border-radius: 15px;
            padding: 25px 20px;
            color: var(--text);
            font-size: 1.3rem;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 160px;
        }
        
        .condition-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
            background: linear-gradient(145deg, var(--card-hover), #193355);
        }
        
        .condition-card.playing {
            background: linear-gradient(145deg, var(--accent-dark), #0d47a1);
            animation: pulse 1.5s infinite;
        }
        
        .condition-card.room-playing {
            background: linear-gradient(145deg, var(--success), #2e7d32);
            animation: roomPulse 1.5s infinite;
        }
        
        .condition-icon {
            font-size: 2.2rem;
            margin-bottom: 15px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Controls */
        .controls {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px;
            margin: 0 auto 30px;
            max-width: 800px;
        }
        
        .controls h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        
        .slider {
            width: 200px;
            height: 8px;
            -webkit-appearance: none;
            appearance: none;
            background: #2c4a6d;
            border-radius: 4px;
            outline: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }
        
        .toggle-btn {
            background: rgba(79, 195, 247, 0.2);
            border: 2px solid rgba(79, 195, 247, 0.5);
            color: var(--accent);
            border-radius: 50px;
            padding: 10px 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .toggle-btn.active {
            background: rgba(79, 195, 247, 0.4);
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(79, 195, 247, 0.3);
        }
        
        /* Status and Alerts */
        .status {
            background: rgba(76, 175, 80, 0.15);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            display: none;
        }
        
        .status.active {
            display: block;
            animation: statusPulse 2s infinite;
        }
        
        .status.looping {
            background: rgba(255, 152, 0, 0.15);
            border: 2px solid rgba(255, 152, 0, 0.3);
            animation: statusPulseLoop 2s infinite;
        }
        
        .alert {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
            text-align: center;
            animation: alertPulse 2s infinite;
        }
        
        .warning {
            background: rgba(255, 193, 7, 0.15);
            border-left: 4px solid var(--warning);
            padding: 15px;
            margin: 20px auto;
            border-radius: 0 8px 8px 0;
            max-width: 800px;
        }
        
        /* Instructions */
        .instructions {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 800px;
        }
        
        /* Footer */
        .app-footer {
            text-align: center;
            padding: 20px;
            color: #90a4ae;
            font-size: 0.8rem;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Offline Notification */
        .offline-notice {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, var(--danger), #b71c1c);
            border-radius: 25px;
            padding: 10px 20px;
            z-index: 1500;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(198, 40, 40, 0.3);
            display: none;
        }
        
        .offline-notice.show {
            display: flex;
            animation: slideDown 0.3s ease;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            z-index: 2000;
            animation: fadeInOut 3s ease;
            display: none;
        }
        
        /* Animations */
        @keyframes alarmPulse {
            0% { 
                background: linear-gradient(145deg, var(--danger), #b71c1c);
                box-shadow: 0 6px 12px rgba(198, 40, 40, 0.3);
            }
            100% { 
                background: linear-gradient(145deg, #ff5252, #d32f2f);
                box-shadow: 0 6px 20px rgba(255, 82, 82, 0.5);
            }
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(79, 195, 247, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(79, 195, 247, 0); }
            100% { box-shadow: 0 0 0 0 rgba(79, 195, 247, 0); }
        }
        
        @keyframes roomPulse {
            0% { box-shadow: 0 0 0 0 rgba(56, 142, 60, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(56, 142, 60, 0); }
            100% { box-shadow: 0 0 0 0 rgba(56, 142, 60, 0); }
        }
        
        @keyframes statusPulse {
            0% { border-color: rgba(76, 175, 80, 0.3); }
            50% { border-color: rgba(76, 175, 80, 0.7); }
            100% { border-color: rgba(76, 175, 80, 0.3); }
        }
        
        @keyframes statusPulseLoop {
            0% { border-color: rgba(255, 152, 0, 0.3); }
            50% { border-color: rgba(255, 152, 0, 0.7); }
            100% { border-color: rgba(255, 152, 0, 0.3); }
        }
        
        @keyframes alertPulse {
            0% { border-color: rgba(220, 53, 69, 0.5); }
            50% { border-color: rgba(220, 53, 69, 0.9); }
            100% { border-color: rgba(220, 53, 69, 0.5); }
        }
        
        @keyframes slideDown {
            from { transform: translate(-50%, -20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, 20px); }
            15% { opacity: 1; transform: translate(-50%, 0); }
            85% { opacity: 1; transform: translate(-50%, 0); }
            100% { opacity: 0; transform: translate(-50%, -20px); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                margin-top: 60px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .subtitle {
                font-size: 0.9rem;
            }
            
            .app-stages {
                flex-direction: column;
                align-items: center;
                gap: 10px;
            }
            
            .rooms-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .conditions-grid {
                grid-template-columns: 1fr;
            }
            
            .condition-card {
                min-height: 140px;
                font-size: 1.2rem;
            }
            
            .modal-content {
                padding: 20px;
            }
            
            .modal-actions {
                flex-direction: column;
            }
            
            .modal-btn {
                width: 100%;
            }
            
            .control-group {
                flex-direction: column;
                gap: 10px;
            }
            
            .slider {
                width: 100%;
                max-width: 250px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 15px;
                padding-bottom: 70px;
            }
            
            .app-header {
                padding: 12px 15px;
            }
            
            .app-title {
                font-size: 1rem;
            }
            
            .room-card {
                padding: 20px 10px;
                font-size: 1.5rem;
                min-height: 100px;
            }
            
            .conditions-grid {
                gap: 15px;
            }
        }
        
        /* Standalone mode adjustments */
        @media all and (display-mode: standalone) {
            body {
                padding-top: env(safe-area-inset-top);
                padding-bottom: calc(env(safe-area-inset-bottom) + 20px);
            }
            
            .app-header {
                padding-top: calc(15px + env(safe-area-inset-top));
                padding-bottom: 15px;
                height: calc(60px + env(safe-area-inset-top));
            }
            
            .container {
                margin-top: calc(70px + env(safe-area-inset-top));
            }
            
            .install-btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Web App Header -->
    <header class="app-header">
        <div class="app-title">
            <i class="fas fa-briefcase-medical"></i> Emergency Trainer
        </div>
        <div class="app-actions">
            <button class="icon-btn" id="helpBtn" title="Help">
                <i class="fas fa-question-circle"></i>
            </button>
            <button class="icon-btn" id="settingsBtn" title="Settings">
                <i class="fas fa-cog"></i>
            </button>
            <button class="install-btn" id="installBtn">
                <i class="fas fa-download"></i> Install
            </button>
        </div>
    </header>
    
    <!-- Offline Notification -->
    <div class="offline-notice" id="offlineNotice">
        <i class="fas fa-wifi-slash"></i>
        <span>You are offline</span>
    </div>
    
    <!-- Main Content -->
    <div class="container">
        <header>
            <h1>Emergency Health Conditions</h1>
            <p class="subtitle">Select a room number first, then choose a medical condition to hear room announcement followed by emergency sound for training purposes.</p>
        </header>
        
        <!-- App Progress -->
        <div class="app-stages">
            <div class="stage active" id="stage1">
                <div class="stage-number">1</div>
                <div class="stage-text">Select Room</div>
            </div>
            <div class="stage" id="stage2">
                <div class="stage-number">2</div>
                <div class="stage-text">Choose Condition</div>
            </div>
        </div>
        
        <!-- Room Confirmation Modal -->
        <div class="modal" id="roomModal">
            <div class="modal-content">
                <div class="modal-icon">
                    <i class="fas fa-door-open"></i>
                </div>
                <h2 class="modal-title">Confirm Room Selection</h2>
                <div class="modal-room" id="confirmRoom">---</div>
                <p class="modal-text">You are about to select this room for emergency condition training. All subsequent actions will be associated with this room.</p>
                <div class="modal-actions">
                    <button class="modal-btn btn-secondary" id="cancelRoom">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="modal-btn btn-primary" id="confirmRoomBtn">
                        <i class="fas fa-check"></i> Confirm
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Room Selection -->
        <div class="room-selection" id="roomSelection">
            <h2>Select Room Number</h2>
            <div class="rooms-grid" id="roomsGrid">
                <!-- Generated by JS -->
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Instructions</h3>
                <p>1. Select a room number from 301 to 305 to begin</p>
                <p>2. You will hear a room alarm sound and be asked to confirm</p>
                <p>3. After confirming, choose a medical condition to hear sounds</p>
                <p>4. Room announcement plays first, then emergency sound</p>
                <p>5. Enable loop to continuously repeat the emergency sound</p>
                <p><small>Press Space to stop any playing sound, Esc to go back</small></p>
            </div>
        </div>
        
        <!-- Condition Selection -->
        <div class="condition-selection" id="conditionSelection">
            <div class="condition-header">
                <div class="selected-room">
                    <i class="fas fa-door-closed"></i>
                    Selected: <span id="selectedRoom">Not Selected</span>
                </div>
                <button class="change-room" id="changeRoom">
                    <i class="fas fa-exchange-alt"></i> Change Room
                </button>
            </div>
            
            <h2>Select Medical Condition</h2>
            <div class="conditions-grid" id="conditionsGrid">
                <!-- Generated by JS -->
            </div>
            
            <div class="status" id="playbackStatus">
                <h3><i class="fas fa-bullhorn"></i> Playback Active</h3>
                <p>Playing room <span id="statusRoom">---</span> announcement followed by emergency sound...</p>
            </div>
            
            <div class="alert">
                <h3><i class="fas fa-exclamation-triangle"></i> Emergency Alert</h3>
                <p>If this is a real emergency in room <span id="alertRoom">---</span>, call emergency services immediately.</p>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <h2>Sound Controls</h2>
            
            <div class="control-group">
                <i class="fas fa-volume-down" style="color: var(--accent);"></i>
                <input type="range" min="0" max="100" value="70" class="slider" id="volumeSlider">
                <i class="fas fa-volume-up" style="color: var(--accent);"></i>
            </div>
            
            <div class="control-group">
                <i class="fas fa-tachometer-alt" style="color: var(--accent);"></i>
                <input type="range" min="50" max="200" value="100" class="slider" id="speedSlider">
                <i class="fas fa-running" style="color: var(--accent);"></i>
            </div>
            
            <div class="control-group">
                <button class="toggle-btn active" id="loopToggle">
                    <i class="fas fa-redo"></i> Loop Sound: <span id="loopStatus">ON</span>
                </button>
            </div>
            
            <p style="text-align: center; color: var(--text-light); margin-top: 15px; font-size: 0.9rem;">
                Speed: <span id="speedValue">1.0x</span> | Volume: <span id="volumeValue">70%</span>
            </p>
        </div>
        
        <!-- Warning -->
        <div class="warning">
            <p><i class="fas fa-exclamation-triangle"></i> <strong>Important:</strong> This is a training tool only. In real emergencies, always call emergency services immediately.</p>
        </div>
        
        <!-- Footer -->
        <footer class="app-footer">
            <p>Emergency Health Conditions Training App</p>
            <p style="margin-top: 5px; font-size: 0.7rem; color: #78909c;">Version 2.0 • Works Offline • For Training Purposes</p>
        </footer>
    </div>
    
    <!-- Toast for notifications -->
    <div class="toast" id="toast"></div>

    <script>
        // App Configuration
        const APP = {
            name: 'Emergency Trainer',
            version: '2.0',
            audioFiles: [
                '301.mp3', '302.mp3', '303.mp3', '304.mp3', '305.mp3',
                'not okay.mp3', 'okay.mp3',
                'asthma attack.mp3', 'fainted.mp3', 'seizure.mp3',
                'sprained.mp3', 'allergic reaction.mp3', 'bleeding.mp3',
                'choking.mp3', 'panic attack.mp3'
            ]
        };

        // Conditions Data
        const CONDITIONS = [
            { name: "ASTHMA ATTACK", icon: "fas fa-lungs", sound: "asthma attack.mp3" },
            { name: "FAINTING", icon: "fas fa-user-injured", sound: "fainted.mp3" },
            { name: "SEIZURE", icon: "fas fa-brain", sound: "seizure.mp3" },
            { name: "SPRAIN", icon: "fas fa-bone", sound: "sprained.mp3" },
            { name: "ALLERGIC REACTION", icon: "fas fa-allergies", sound: "allergic reaction.mp3" },
            { name: "CUT or BLEEDING", icon: "fas fa-tint", sound: "bleeding.mp3" },
            { name: "CHOKING", icon: "fas fa-wind", sound: "choking.mp3" },
            { name: "PANIC ATTACK", icon: "fas fa-heartbeat", sound: "panic attack.mp3" }
        ];

        // Rooms Configuration
        const ROOMS = [301, 302, 303, 304, 305];
        const ROOM_SOUNDS = {
            301: "301.mp3", 302: "302.mp3", 303: "303.mp3",
            304: "304.mp3", 305: "305.mp3"
        };

        // App State
        let state = {
            selectedRoom: null,
            pendingRoom: null,
            currentAudio: null,
            currentCondition: null,
            currentButton: null,
            isPlaying: false,
            volume: 0.7,
            speed: 1.0,
            loop: true,
            deferredPrompt: null,
            isOnline: navigator.onLine
        };

        // DOM Elements
        const elements = {
            // Header
            installBtn: document.getElementById('installBtn'),
            helpBtn: document.getElementById('helpBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            
            // Stages
            stage1: document.getElementById('stage1'),
            stage2: document.getElementById('stage2'),
            
            // Modals
            roomModal: document.getElementById('roomModal'),
            confirmRoom: document.getElementById('confirmRoom'),
            cancelRoom: document.getElementById('cancelRoom'),
            confirmRoomBtn: document.getElementById('confirmRoomBtn'),
            
            // Room Selection
            roomSelection: document.getElementById('roomSelection'),
            roomsGrid: document.getElementById('roomsGrid'),
            
            // Condition Selection
            conditionSelection: document.getElementById('conditionSelection'),
            conditionsGrid: document.getElementById('conditionsGrid'),
            selectedRoom: document.getElementById('selectedRoom'),
            alertRoom: document.getElementById('alertRoom'),
            changeRoom: document.getElementById('changeRoom'),
            
            // Controls
            volumeSlider: document.getElementById('volumeSlider'),
            speedSlider: document.getElementById('speedSlider'),
            speedValue: document.getElementById('speedValue'),
            volumeValue: document.getElementById('volumeValue'),
            loopToggle: document.getElementById('loopToggle'),
            loopStatus: document.getElementById('loopStatus'),
            
            // Status
            playbackStatus: document.getElementById('playbackStatus'),
            statusRoom: document.getElementById('statusRoom'),
            
            // Notifications
            offlineNotice: document.getElementById('offlineNotice'),
            toast: document.getElementById('toast')
        };

        // Initialize App
        function initApp() {
            setupUI();
            setupEventListeners();
            setupPWA();
            setupAudioCache();
            checkNetworkStatus();
            
            // Show welcome toast
            setTimeout(() => {
                showToast('Emergency Trainer is ready!');
            }, 1000);
        }

        // Setup UI Components
        function setupUI() {
            // Create room cards
            ROOMS.forEach(room => {
                const card = document.createElement('button');
                card.className = 'room-card';
                card.setAttribute('data-room', room);
                card.setAttribute('aria-label', `Select Room ${room}`);
                card.innerHTML = `
                    <div class="room-number">${room}</div>
                    <div class="room-label">Room</div>
                `;
                card.addEventListener('click', () => selectRoom(room));
                elements.roomsGrid.appendChild(card);
            });

            // Create condition cards
            CONDITIONS.forEach((condition, index) => {
                const card = document.createElement('button');
                card.className = 'condition-card';
                card.setAttribute('data-sound', condition.sound);
                card.setAttribute('aria-label', `${condition.name}. Press to play. Shortcut: ${index + 1}`);
                card.innerHTML = `
                    <div class="condition-icon">
                        <i class="${condition.icon}"></i>
                    </div>
                    <div class="condition-name">${condition.name}</div>
                `;
                card.addEventListener('click', () => playCondition(condition.sound, card));
                elements.conditionsGrid.appendChild(card);
            });

            // Update control values
            updateControlValues();
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Room selection
            elements.confirmRoomBtn.addEventListener('click', confirmRoom);
            elements.cancelRoom.addEventListener('click', closeRoomModal);
            elements.changeRoom.addEventListener('click', goToRoomSelection);

            // Controls
            elements.volumeSlider.addEventListener('input', updateVolume);
            elements.speedSlider.addEventListener('input', updateSpeed);
            elements.loopToggle.addEventListener('click', toggleLoop);

            // Header buttons
            elements.helpBtn.addEventListener('click', showHelp);
            elements.settingsBtn.addEventListener('click', showSettings);

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboard);
            
            // Modal close on outside click
            elements.roomModal.addEventListener('click', (e) => {
                if (e.target === elements.roomModal) closeRoomModal();
            });
            
            // Network status
            window.addEventListener('online', () => updateNetworkStatus(true));
            window.addEventListener('offline', () => updateNetworkStatus(false));
        }

        // Room Selection
        function selectRoom(room) {
            state.pendingRoom = room;
            elements.confirmRoom.textContent = room;
            playRoomSound(room);
            elements.roomModal.classList.add('active');
            
            // Highlight selected room
            document.querySelectorAll('.room-card').forEach(card => {
                card.classList.remove('selected', 'alarming');
                if (parseInt(card.dataset.room) === room) {
                    card.classList.add('selected');
                }
            });
        }

        function confirmRoom() {
            state.selectedRoom = state.pendingRoom;
            closeRoomModal();
            
            // Update displays
            elements.selectedRoom.textContent = `Room ${state.selectedRoom}`;
            elements.alertRoom.textContent = state.selectedRoom;
            elements.statusRoom.textContent = state.selectedRoom;
            
            // Switch to condition selection
            elements.roomSelection.classList.add('hidden');
            elements.conditionSelection.classList.add('active');
            
            // Update stages
            elements.stage1.classList.remove('active');
            elements.stage2.classList.add('active');
            
            // Play confirmation
            playSound('okay.mp3');
            
            showToast(`Room ${state.selectedRoom} selected`);
        }

        function closeRoomModal() {
            elements.roomModal.classList.remove('active');
            stopAllSounds();
            
            // Remove alarm animation
            document.querySelectorAll('.room-card').forEach(card => {
                card.classList.remove('alarming');
            });
        }

        // Audio Playback
        function playRoomSound(room) {
            const sound = ROOM_SOUNDS[room] || 'not okay.mp3';
            playSound(sound, true);
            
            // Add alarm animation
            document.querySelectorAll('.room-card').forEach(card => {
                if (parseInt(card.dataset.room) === room) {
                    card.classList.add('alarming');
                }
            });
        }

        async function playCondition(sound, button) {
            if (state.isPlaying) {
                stopAllSounds();
                if (state.currentButton === button) return;
            }
            
            if (!state.selectedRoom) {
                showToast('Please select a room first');
                return;
            }
            
            state.isPlaying = true;
            state.currentButton = button;
            
            // Update UI
            elements.playbackStatus.classList.add('active');
            elements.statusRoom.textContent = state.selectedRoom;
            button.classList.add('room-playing');
            
            // Play room announcement
            const roomSound = ROOM_SOUNDS[state.selectedRoom] || 'not okay.mp3';
            try {
                await playSound(roomSound, false);
            } catch (e) {
                console.warn('Room sound failed:', e);
            }
            
            // Play condition sound
            button.classList.remove('room-playing');
            button.classList.add('playing');
            
            try {
                await playSound(sound, state.loop);
                if (!state.loop) {
                    endPlayback();
                }
            } catch (e) {
                console.error('Condition sound failed:', e);
                showToast('Failed to play sound');
                endPlayback();
            }
        }

        async function playSound(soundFile, loop = false) {
            return new Promise((resolve, reject) => {
                stopAllSounds();
                
                const audio = new Audio(soundFile);
                audio.volume = state.volume;
                audio.playbackRate = state.speed;
                audio.loop = loop;
                
                audio.addEventListener('ended', () => {
                    if (!loop) resolve();
                });
                
                audio.addEventListener('error', reject);
                
                audio.play().then(() => {
                    state.currentAudio = audio;
                    if (loop) resolve();
                }).catch(reject);
            });
        }

        function stopAllSounds() {
            if (state.currentAudio) {
                state.currentAudio.pause();
                state.currentAudio.currentTime = 0;
                state.currentAudio = null;
            }
            
            state.isPlaying = false;
            elements.playbackStatus.classList.remove('active', 'looping');
            
            if (state.currentButton) {
                state.currentButton.classList.remove('playing', 'room-playing');
                state.currentButton = null;
            }
        }

        function endPlayback() {
            state.isPlaying = false;
            elements.playbackStatus.classList.remove('active', 'looping');
            
            if (state.currentButton) {
                state.currentButton.classList.remove('playing', 'room-playing');
                state.currentButton = null;
            }
        }

        // Controls
        function updateVolume() {
            state.volume = elements.volumeSlider.value / 100;
            elements.volumeValue.textContent = `${elements.volumeSlider.value}%`;
            
            if (state.currentAudio) {
                state.currentAudio.volume = state.volume;
            }
        }

        function updateSpeed() {
            state.speed = elements.speedSlider.value / 100;
            elements.speedValue.textContent = `${state.speed.toFixed(1)}x`;
            
            if (state.currentAudio) {
                state.currentAudio.playbackRate = state.speed;
            }
        }

        function toggleLoop() {
            state.loop = !state.loop;
            elements.loopToggle.classList.toggle('active', state.loop);
            elements.loopStatus.textContent = state.loop ? 'ON' : 'OFF';
            
            if (state.currentAudio) {
                state.currentAudio.loop = state.loop;
                elements.playbackStatus.classList.toggle('looping', state.loop);
            }
        }

        function updateControlValues() {
            elements.volumeValue.textContent = `${elements.volumeSlider.value}%`;
            elements.speedValue.textContent = `${(elements.speedSlider.value / 100).toFixed(1)}x`;
        }

        // Navigation
        function goToRoomSelection() {
            stopAllSounds();
            
            elements.roomSelection.classList.remove('hidden');
            elements.conditionSelection.classList.remove('active');
            
            elements.stage1.classList.add('active');
            elements.stage2.classList.remove('active');
            
            showToast('Room selection');
        }

        // Keyboard Shortcuts
        function handleKeyboard(e) {
            // Prevent default for app shortcuts
            switch (e.key) {
                case ' ':
                    e.preventDefault();
                    if (state.currentAudio) {
                        if (state.currentAudio.paused) {
                            state.currentAudio.play();
                        } else {
                            state.currentAudio.pause();
                        }
                    }
                    break;
                    
                case 'Escape':
                    e.preventDefault();
                    if (elements.roomModal.classList.contains('active')) {
                        closeRoomModal();
                    } else if (state.isPlaying) {
                        stopAllSounds();
                    } else if (elements.conditionSelection.classList.contains('active')) {
                        goToRoomSelection();
                    }
                    break;
                    
                case '1':
                case '2':
                case '3':
                case '4':
                case '5':
                    if (elements.roomSelection.classList.contains('hidden')) break;
                    e.preventDefault();
                    const roomIndex = parseInt(e.key) - 1;
                    if (ROOMS[roomIndex]) selectRoom(ROOMS[roomIndex]);
                    break;
                    
                case 'l':
                case 'L':
                    e.preventDefault();
                    toggleLoop();
                    break;
                    
                case '?':
                    e.preventDefault();
                    showHelp();
                    break;
            }
            
            // Number keys 1-8 for conditions
            if (e.key >= '1' && e.key <= '8' && elements.conditionSelection.classList.contains('active')) {
                e.preventDefault();
                const index = parseInt(e.key) - 1;
                const buttons = document.querySelectorAll('.condition-card');
                if (buttons[index]) buttons[index].click();
            }
        }

        // PWA Setup
        function setupPWA() {
            // Check if app is installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                elements.installBtn.style.display = 'none';
            }
            
            // Before install prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                state.deferredPrompt = e;
                elements.installBtn.classList.add('show');
            });
            
            // App installed
            window.addEventListener('appinstalled', () => {
                state.deferredPrompt = null;
                elements.installBtn.classList.remove('show');
                showToast('App installed successfully!');
            });
            
            // Install button
            elements.installBtn.addEventListener('click', async () => {
                if (!state.deferredPrompt) {
                    showToast('Install not available in this browser');
                    return;
                }
                
                state.deferredPrompt.prompt();
                const { outcome } = await state.deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    state.deferredPrompt = null;
                    elements.installBtn.classList.remove('show');
                }
            });
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(() => console.log('Service Worker registered'))
                    .catch(err => console.log('SW registration failed:', err));
            }
        }

        // Audio Cache Setup
        function setupAudioCache() {
            // Preload important sounds
            const preloadSounds = ['not okay.mp3', 'okay.mp3'];
            preloadSounds.forEach(sound => {
                const audio = new Audio();
                audio.src = sound;
                audio.preload = 'auto';
            });
        }

        // Network Status
        function checkNetworkStatus() {
            updateNetworkStatus(navigator.onLine);
        }

        function updateNetworkStatus(online) {
            state.isOnline = online;
            elements.offlineNotice.classList.toggle('show', !online);
            
            if (!online) {
                showToast('App is working offline');
            }
        }

        // UI Helpers
        function showToast(message) {
            elements.toast.textContent = message;
            elements.toast.style.display = 'block';
            
            setTimeout(() => {
                elements.toast.style.display = 'none';
            }, 3000);
        }

        function showHelp() {
            const helpText = `
                Emergency Trainer - Keyboard Shortcuts:
                
                Room Selection:
                1-5: Select rooms 301-305
                
                Condition Selection:
                1-8: Select conditions 1-8
                
                Global:
                Space: Play/Pause current sound
                Esc: Stop sound / Go back
                L: Toggle loop mode
                ?: Show this help
                
                Touch: Tap buttons to select rooms and conditions
            `;
            alert(helpText);
        }

        function showSettings() {
            const settings = `
                Current Settings:
                
                Volume: ${(state.volume * 100).toFixed(0)}%
                Speed: ${state.speed.toFixed(1)}x
                Loop: ${state.loop ? 'ON' : 'OFF'}
                Room: ${state.selectedRoom || 'Not selected'}
                Network: ${state.isOnline ? 'Online' : 'Offline'}
                
                App Version: ${APP.version}
            `;
            alert(settings);
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Prevent pull-to-refresh on mobile
        document.addEventListener('touchmove', (e) => {
            if (window.scrollY === 0) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>